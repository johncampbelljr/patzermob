<html>
	<head>
		<title>Community Chess</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript" ></script>
		<script src="chess/chess.js" type="text/javascript" ></script>
		<script src="socket.io/socket.io.js"></script>
		<link rel="stylesheet" type="text/css" href="board.css" />
	</head>
	<body>
<!-- grabbed the chess board from http://designindevelopment.com/css/css3-chess-board/ -->
	<table id="chess_board" cellpadding="0" cellspacing="0">
	<tr>
		<td id="A8"/>
		<td id="B8"/>
		<td id="C8"/>
		<td id="D8"/>
		<td id="E8"/>
		<td id="F8"/>
		<td id="G8"/>
		<td id="H8"/>
	</tr>
	<tr>
		<td id="A7"/>
		<td id="B7"/>
		<td id="C7"/>
		<td id="D7"/>
		<td id="E7"/>
		<td id="F7"/>
		<td id="G7"/>
		<td id="H7"/>
	</tr>
	<tr>
		<td id="A6"/>
		<td id="B6"/>
		<td id="C6"/>
		<td id="D6"/>
		<td id="E6"/>
		<td id="F6"/>
		<td id="G6"/>
		<td id="H6"/>
	</tr>
	<tr>
		<td id="A5"/>
		<td id="B5"/>
		<td id="C5"/>
		<td id="D5"/>
		<td id="E5"/>
		<td id="F5"/>
		<td id="G5"/>
		<td id="H5"/>
	</tr>
	<tr>
		<td id="A4"/>
		<td id="B4"/>
		<td id="C4"/>
		<td id="D4"/>
		<td id="E4"/>
		<td id="F4"/>
		<td id="G4"/>
		<td id="H4"/>
	</tr>
	<tr>
		<td id="A3"/>
		<td id="B3"/>
		<td id="C3"/>
		<td id="D3"/>
		<td id="E3"/>
		<td id="F3"/>
		<td id="G3"/>
		<td id="H3"/>
	</tr>
	<tr>
		<td id="A2"/>
		<td id="B2"/>
		<td id="C2"/>
		<td id="D2"/>
		<td id="E2"/>
		<td id="F2"/>
		<td id="G2"/>
		<td id="H2"/>
	</tr>
	<tr>
		<td id="A1"/>
		<td id="B1"/>
		<td id="C1"/>
		<td id="D1"/>
		<td id="E1"/>
		<td id="F1"/>
		<td id="G1"/>
		<td id="H1"/>
	</tr>
</table>
	</body>
<script>

var fenChars = "KQRBNPkqrbnp";
var colChars = "ABCDEFGH";
function getChessFontCharFromFen(fenChar) {
	return String.fromCharCode(9812 + this.fenChars.indexOf(fenChar));
}

$(function() {
	$('td').addClass('piece');
	$.ajax({
	  url: 'ajax/board',
	    	success: function(data) {
			displayFen(data.board);
		}
	});

	var socket = io.connect('http://localhost');
      	socket.on('notification', function (data) {
      	});
      	socket.on('move_complete', function (data) {
		displayFen(data.board);
      	});
});

function displayFen(fenString) {
	$("td").text("");
	var ranks = fenString.split(/\s/g)[0].split("/");
	ranks.forEach(function(element, index, array) {
		var colNo = 0;
		for (var idx = 0; idx < element.length; idx++) {
			var char = element.charAt(idx);
			if ( char.match(/[0-8]/) ) {
				colNo+=char/1;
				continue;
			}
			id = "#" + colChars.charAt(colNo) + (8 - index); 
			var item = $(id);
			item.text(getChessFontCharFromFen(char));
			colNo++;		
		}
	});
}
</script>
</html>
